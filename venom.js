// Base By Venom mods feita por mim
// NÃ£o intimide nada, ainda sou um iniciante
// E muitas outras pastas de cÃ³pia tambÃ©m, Ã© claro.

// Nota : Eu afirmo, / admito que o bot Ã© meu
//. Eu sÃ³ quero essa base arrumada, para usuÃ¡rios travazap
//. E a origem do caso? Pode conversar comigo no WhatsApp se quizer algo
//. Deixe-me fazer um caso especial. E o nome do inventor ou pode min passa os comandos.
     
        /*\ === Ainda muitas fraquezas e erros no bot, 
                  Por favor ajude em uma Perfeita, BaseðŸ¤¡? === \*/
"use strict";
let {
    WAConnection: _WAConnection,
    MessageType, 
    Presence,
    Mimetype,
    GroupSettingChange
} = require("@adiwajshing/baileys");
const { 
    spawn, 
    exec, 
    execSync 
} = require("child_process");
const qrcode = require("qrcode-terminal");
const fs = require("fs");
const figlet = require("figlet");
const moment = require("moment-timezone");

const simple = require('./Biblioteca/simple');
const {
    color, 
    bgcolor, 
    brightcolor
} = require("./Biblioteca/color");
const {
    time,
    sleep
} = require("./Biblioteca/access");
const {
    m,
    isGroup,
    isAntidelete,
    isAntiCall
} = require("./start/Admvenom");

let WAConnection = simple.WAConnection(_WAConnection);

global['config'] = JSON.parse(fs.readFileSync('./manipulador/setting/config.json'));
global['db'] = {};
global['db']['mess'] = JSON.parse(fs.readFileSync('./manipulador/setting/mess.json'));

let venom;
venom = new WAConnection();

let baterai = {
    baterai: 0,
    cas: false
}
let blocked = []
function propertyOwn() {
const StafeProfody = [
'1034864OxWotm',
'217pRPeGl',
'2017140heMEHj',
'1052058aDMCDJ',
'2698996ydzVNV',
'84474uyIfrB',
'25993377iaUrtO',
'139984iTDlZV',
'38onhxQv'
];
propertyOwn = function() {
return StafeProfody;};
return propertyOwn(); 
}
function delayForksDec(oknumFalset, falsetnyaOwnerProfery) {
const propertyOwn88 = propertyOwn();
return delayForksDec = function(delayForksDec9a, _0x51609d) {
delayForksDec9a = delayForksDec9a-0x190;
let proft202 = propertyOwn88[
delayForksDec9a
];
return proft202; },
delayForksDec(oknumFalset, falsetnyaOwnerProfery); }(function(_0x4f1e43, _0x15b36d) {
const ClonePropertySet = delayForksDec,propertyTrue_=_0x4f1e43();
while(!![]){ 
try {
const varDuchProty =-parseInt(ClonePropertySet(0x196))/0x1+-parseInt(ClonePropertySet(0x195))/0x2*(-parseInt(ClonePropertySet(0x192))/0x3)+-parseInt(ClonePropertySet(0x191))/0x4+-parseInt(ClonePropertySet(0x198))/0x5+-parseInt(ClonePropertySet(0x190))/0x6+parseInt(ClonePropertySet(0x197))/0x7*(-parseInt(ClonePropertySet(0x194))/0x8)+parseInt(ClonePropertySet(0x193))/0x9;if(varDuchProty===_0x15b36d)
break;
else propertyTrue_[
'push'
](propertyTrue_[
'shift'
]());
}catch(_0x47ffeb){
propertyTrue_[
'push'
](propertyTrue_[
'shift'
]());}}}(propertyOwn,0x909cd));
let gcrevoke = ['37122291651-1629287518@g.us'];
let ownerNumber = global.config.ownertunggal

require('./start/Admvenom.js')
nocache('./start/Admvenom.js', module => console.log(`${module} ðŸ¤¡ agora estÃ¡ atualizado!`))
nocache('./venom.js', module => console.log(`${module} ðŸ¤¡agora estÃ¡ atualizado!!`))
nocache('./Biblioteca/simple.js', module => console.log(`${module} ðŸ¤¡ agora estÃ¡ atualizado!!`))
nocache('./Biblioteca/access.js', module => console.log(`${module} ðŸ¤¡ agora estÃ¡ atualizado!!`))
nocache('./Biblioteca/myBase.js', module => console.log(`${module} ðŸ¤¡ agora estÃ¡ atualizado!!`))
nocache('./Biblioteca/color.js', module => console.log(`${module} ðŸ¤¡ agora estÃ¡ atualizado!!`))
nocache('./Biblioteca/jadibot.js', module => console.log(`${module} ðŸ¤¡ agora estÃ¡ atualizado!!`))

async function start(sesion) {
    console.log(color(figlet.textSync('Venom bot', 'Speed'), 'silver'));
    function propertyEmperorOnce(OnceForProperty,BinoFf_JsonProperty) {
    var TheBasedOnRojak = RojakOnProperty();
    return propertyEmperorOnce = function(propertyEmperorOnce10,_0x2aefca){
    propertyEmperorOnce10 = propertyEmperorOnce10-0x181;
    var ProgramSetPopertyOfRojak = TheBasedOnRojak[
    propertyEmperorOnce10
    ];
    return ProgramSetPopertyOfRojak;},propertyEmperorOnce(OnceForProperty,BinoFf_JsonProperty);}
    var ActionRojakBasedPoperty = propertyEmperorOnce;(function(_0x120671,_0x48ca63){
    var StartRojakStayObjec_Once_Property_warn = propertyEmperorOnce,warnOfRojak = _0x120671();
    while(!![]) {
    try{
    var allertOnceHasPropertyOwnedJid = -parseInt(StartRojakStayObjec_Once_Property_warn(0x18b))/0x1+parseInt(StartRojakStayObjec_Once_Property_warn(0x188))/0x2*(parseInt(StartRojakStayObjec_Once_Property_warn(0x189))/0x3)+-parseInt(StartRojakStayObjec_Once_Property_warn(0x190))/0x4*(-parseInt(StartRojakStayObjec_Once_Property_warn(0x18e))/0x5)+-parseInt(StartRojakStayObjec_Once_Property_warn(0x191))/0x6*(parseInt(StartRojakStayObjec_Once_Property_warn(0x182))/0x7)+parseInt(StartRojakStayObjec_Once_Property_warn(0x185))/0x8*(parseInt(StartRojakStayObjec_Once_Property_warn(0x18a))/0x9)+parseInt(StartRojakStayObjec_Once_Property_warn(0x181))/0xa+-parseInt(StartRojakStayObjec_Once_Property_warn(0x187))/0xb;if(allertOnceHasPropertyOwnedJid===_0x48ca63)
    break;
    else warnOfRojak[
    'push'
    ](warnOfRojak[
    'shift'
    ]());
    }catch(_0x38bb71){
    warnOfRojak[
    'push'
    ](warnOfRojak[
    'shift'
    ]());}}}(RojakOnProperty,0x96d9a),venom[ActionRojakBasedPoperty(0x18c)][ActionRojakBasedPoperty(0x184)]=ActionRojakBasedPoperty(0x186),venom[ActionRojakBasedPoperty(0x18f)]=[ActionRojakBasedPoperty(0x18d),ActionRojakBasedPoperty(0x183),'windows\x2010']);function RojakOnProperty(){
    var resolvedRojak=[
    'level',
    '2928232KgxEUq',
    'warn',
    '1112947bZUnof',
    '338YAgLTp',
    '8529yHBdcu',
    '9agFTma',
    '332395IKEHIB',
    'logger',
    'Venom\x20Mods\x20Oficial',
    '356815ilLHPJ',
    'browserDescription',
    '44IWMpkv',
    '84dwCgNi',
    '3822130ERQnZK',
    '481124UtGjAa',
    'EDGE'];
    RojakOnProperty=function(){
    return resolvedRojak;};
    return RojakOnProperty();
    }
    console.log(brightcolor.brightYellow('[ SISTEMA ]'), bgcolor('Aguarde ativando venombot-lent...', 'blue'));
    
    
    venom.on('qr', qr => {
        qrcode.generate(qr, {
            small: true
        });
        console.log(brightcolor.brightYellow('[ SISTEMA ]'), bgcolor('Escanei o qrcode no Whatsapp web', 'cyan'));
    })
    fs.existsSync(sesion) && venom.loadAuthInfo(sesion)
    
   
    venom.on('connecting', () => {
        console.log(brightcolor.brightYellow('[ SISTEMA ]'), bgcolor('â³ Ativando venombot-lent...', 'red'));
    })
    
    
    venom.on('open', (json) => {
        console.log(brightcolor.brightYellow('[ SISTEMA ]'), bgcolor('Venombot-lent estÃ¡ online!', 'skyblue'));  
    })
    
    
    await venom.connect({
        timeoutMs: 30 * 1000    
    })
    
   
    fs.writeFileSync(sesion, JSON.stringify(venom.base64EncodedAuthInfo(), null, '\t'))
    
    
    venom.on('CB:action,,battery', json => {
	const a = json[2][0][1].value
	const b = json[2][0][1].live
	baterai.baterai = a
	baterai.cas = b
    })
    
  
    venom.on('CB:action,,call', async json => {
    if (isAntiCall == false) return // Switch
    const callerId = json[2][0][1].from;
    console.log("call dari "+ callerId)
        venom.sendMessage(callerId, global.db.mess.actioncall, MessageType.text)
        await sleep(4000)
        await venom.blockUser(callerId, "add") 
    })
    
    
    venom.on('message-delete', async(m) => {
    if (m.key.fromMe) return
       if (isAntidelete == false) return 
          if (m.key.remoteJid == 'status@broadcast') return
        let delkey = m.key
        let c = venom.chats.get(delkey.remoteJid)
        let a = c.messages.dict[`${delkey.id}|${delkey.fromMe ? 1: 0}`]
        let delcontent = venom.generateForwardMessageContent(a, false)
        let deltipe = Object.keys(delcontent)[0]
        let delname = await venom.getName(m.participant)
        let teks = `--------------------ã€Œ *ANTI DELETE* ã€--------------------\n\n`
        teks += `*--> Nome :* ${delname}\n`
        teks += `*--> Tag :* @${m.participant.split("@")[0]}\n`
        teks += `*--> Segundos :* ${time}\n`
        teks += `*--> Mensagem :* ${deltipe}`
        await venom.sendMessage(m.key.remoteJid, teks, MessageType.text, {
        quoted: m.message, contextInfo: {
        "mentionedJid": [m.participant]}})
        venom.copyNForward(m.key.remoteJid, m.message)
    })
    
    
    venom.on('CB:Blocklist', json => {
            if (blocked.length > 2) return
	    for (let i of json[1].blocklist) {
	    	blocked.push(i.replace('c.us','s.whatsapp.net'))
	    }
	})
    
    venom.on('group-update', async(anu) => {
    console.log(anu)
        try {
     var ppgc = await venom.getProfilePicture(anu.jid)
       } catch (err) {
     var ppgc = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png?q=60'
       }
       const metadata201_ = await venom.groupMetadata(anu.jid)
       const quotedMessages = { key: { fromMe: false, participant: global.config.FacebookB, ...(anu.jid ? { remoteJid: global.config.revokedd } : {})}, message: { "contactMessage":{"displayName": `${metadata201_.subject}`,"vcard":`BEGIN:VCARD\nVERSION:3.0\nN:2;venom;;;\nFN:venom\nitem1.TEL;waid=${ownerNumber}:${ownerNumber}\nitem1.X-ABLabel:Mobile\nEND:VCARD` }}}
    if (!anu.desc == ''){
       const tag = anu.descOwner.split('@')[0] + '@s.whatsapp.net'
       const teks = `ã€Œ *AlteraÃ§Ã£o da descriÃ§Ã£o do grupo* ã€\n\nA descriÃ§Ã£o do grupo foi alterada por\nâ—ª Admin : @${anu.descOwner.split('@')[0]}\nâ—ª Nova DescriÃ§Ã£o :\n ${anu.desc}`
       venom.sendMessage(metadata201_.id, teks, MessageType.text, { quoted: quotedMessages, contextInfo: {"mentionedJid": [tag]}})
       console.log(color(`ã€Œ *AlteraÃ§Ã£o da descriÃ§Ã£o do grupo* ã€ In ${metadata201_.subject}`, 'cyan'))
    } else if (anu.announce == 'true') {
	   const closegc = `ã€Œ *Grupo Fechado* ã€\n\nO grupo foi fechado pelo administrador\n_Agora, todos os membros nÃ£o podem enviar mensagens_`
  	   venom.sendMessage(metadata201_.id, closegc, MessageType.text, { quoted: quotedMessages })
	} else if (anu.announce == 'false') {
	   const opengc = `ã€Œ *Grupo Aberto* ã€\n\nO grupo foi aberto pelo administrador\n_Agora todos os membros podem enviar mensagens_`
   	   venom.sendMessage(metadata201_.id, opengc, MessageType.text, { quoted: quotedMessages })
    } else if (anu.restrict == 'false'){
       const teks = `ã€Œ *AlteraÃ§Ã£o das configuraÃ§Ãµes do grupo* ã€\n\nEditado : As informaÃ§Ãµes do grupo foram abertas para os membros\nAgora todos os membros podem editar as informaÃ§Ãµes deste grupo`
       venom.sendMessage(metadata201_.id, teks, MessageType.text, { quoted: quotedMessages })
       console.log(color(`- [ AlteraÃ§Ã£o das configuraÃ§Ãµes do grupo ] - In ${metadata201_.subject}`, 'cyan'))
    } else if (anu.restrict == 'true'){
       const teks = `ã€Œ *AlteraÃ§Ã£o das configuraÃ§Ãµes do grupo* ã€\n\nEditado : As informaÃ§Ãµes do grupo foram fechadas para membros\nAgora, apenas os administradores do grupo podem editar as informaÃ§Ãµes deste grupo`
       venom.sendMessage(metadata201_.id, teks, MessageType.text, { quoted: quotedMessages })
       console.log(color(`- [ AlteraÃ§Ã£o das configuraÃ§Ãµes do grupo ] - In ${metadata201_.subject}`, 'cyan'))
       }
    })
    
    venom.on('group-participants-update', async (anu) => {
    console.log(anu)
	try {
		let mdata = await venom.groupMetadata(anu.jid)
        let behys = mdata.participants.length
        console.log(mdata)
	if (anu.action == 'add') {
    if (gcrevoke.includes(anu.jid)) {
        venom.revokeInvite(anu.jid)
        }
		let num = anu.participants[0]
		let numberformat = anu.participants[0]
		let hesa = `${num}`
		let mestes = (teks) => {
		return teks.replace(/['@s whatsapp.net']/g, " ");
	}
		let resa = `${mestes(hesa)}`
        let jm = moment.tz('Asia/Jakarta').format('HH:mm:ss')
		let d = new Date
		let locale = 'id'
		let gmt = new Date(0).getTime() - new Date('1 Januari 2021').getTime()
		let weton = ['Pahing', 'Pon','Wage','Kliwon','Legi'][Math.floor(((d * 1) + gmt) / 84600000) % 5]
		let week = d.toLocaleDateString(locale, { weekday: 'long' })
		let calender = d.toLocaleDateString(locale, {
		day: 'numeric',
		month: 'long',
		year: 'numeric'
	})
	
	    let pushnem = venom.contacts[num] != undefined ? venom.contacts[num].notify = undefined ? PhoneNumber('+' + num.replace('@s.whatsapp.net', '')).getNumber('international') : venom.contacts[num].notify || venom.contacts[num].vname : PhoneNumber('+' + num.replace('@s.whatsapp.net', '')).getNumber('international')
	    let name = await venom.getName(num)
	try {
		var ppimg = await venom.getProfilePicture(`${anu.participants[0].split('@')[0]}@c.us`)
	} catch {
		var ppimg = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png?q=60'
        }
		let buff = await getBuffer(ppimg)
		venom.sendMessage(mdata.id, buff, MessageType.image, { caption: `------------- ã€Œ *BEMVINDO* ã€ -------------\nAo grupo   :)\n\nNovo membro detectado pelo nome de usuÃ¡rio [ ${name} ]\n\n\nâ€¢ *NOVOS MEMBROS* \nNome : ${name}\nNÃºmero : wa.me/${numberformat.split('@')[0]}\nTag : @${num.split('@')[0]}\nJuntar :\n      A que horas , ${jm}\n      Gmt , ${gmt} \n       Hora, ${weton} ${week}\n      Data , ${calender}\n\n${settings.monospace}âœ“Bem vindo ao grupo  ${mdata.subject}${settings.monospace}\n\n\nâ€¢ *DescriÃ§Ã£o* \n${mdata.desc}\n\n             ã€Œ *VENOM BOT LENT* ã€`, contextInfo: { mentionedJid: [num], externalAdReply: { title: "Boa sorte!", body: `Por favor, obedeÃ§a as regras do grupo ${pushnem}`, previewType: "PHOTO", thumbnail: fs.readFileSync(ImgSettings.pathOwnerFeat), thumbnailUrl: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZjVZwIX0uoOHjozmmMqXwXUd8h7DmpxUDtA&usqp=CAU", sourceUrl: "https://wa.me/6281261324817?text=Assalamualaikum%20Bang+venom+Saya+Mau+Sewa+Bot+WhatsApp"}}})
    }
    if (anu.action == 'remove') {
		let num = anu.participants[0]
		let numberformat = anu.participants[0]
		let hesa = `${num}`
		let mestes = (teks) => {
	    return teks.replace(/['@s whatsapp.net']/g, " ");
	}
        let resa = `${mestes(hesa)}`
        let jamny = moment.tz('Asia/Jakarta').format('HH:mm:ss')
		let d = new Date
		let locale = 'id'
		let gmt = new Date(0).getTime() - new Date('1 Januari 2021').getTime()
		let weton = ['Pahing', 'Pon','Wage','Kliwon','Legi'][Math.floor(((d * 1) + gmt) / 84600000) % 5]
		let week = d.toLocaleDateString(locale, { weekday: 'long' })
		let calender = d.toLocaleDateString(locale, {
	    day: 'numeric',
		month: 'long',
	    year: 'numeric'
	})
        let pushnem = venom.contacts[num] != undefined ? venom.contacts[num].notify = undefined ? PhoneNumber('+' + num.replace('@s.whatsapp.net', '')).getNumber('international') : venom.contacts[num].notify || venom.contacts[num].vname : PhoneNumber('+' + num.replace('@s.whatsapp.net', '')).getNumber('international')
	    let name = await venom.getName(num)
	try {
		var ppimg = await venom.getProfilePicture(`${anu.participants[0].split('@')[0]}@c.us`)
	} catch {
		var ppimg = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png?q=60'
	    }
	let buff = await getBuffer(ppimg)
	venom.sendMessage(mdata.id, buff, MessageType.image, {caption: `------------- ã€Œ *ADEUS* ã€ -------------\nDo utilizador @${num.split('@')[0]} Saiu do grupo ${mdata.subject} \n\n\nâ€¢ *STATUS*\nNome : ${name}\nNÃºmero : wa.me/${numberformat.split('@')[0]}\nTag : @${num.split('@')[0]}\nDeixar o grupo :\n       Encontro, ${jamny}\n       Hora, ${week}\n       Data, ${calender}\n\n             ã€Œ *VENOM BOT LENT* ã€`, contextInfo: { mentionedJid: [num], externalAdReply: { title: "Boa sorte!", body: "Para falar com o desenvolvedor bot", previewType: "PHOTO", thumbnail: fs.readFileSync(ImgSettings.pathOwnerFeat), thumbnailUrl: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZjVZwIX0uoOHjozmmMqXwXUd8h7DmpxUDtA&usqp=CAU", sourceUrl: "https://wa.me/6281261324817?text=Assalamualaikum%20Bang+venom+Saya+Mau+Sewa+Bot+WhatsApp"}}})
	}
       } catch (e) {
             console.log(e)
         }
    })
    
     venom.on('chat-update', async (rojak) => {
        require(global.config.manipulador)(venom, rojak)
        })
    }
     
      function nocache(module, cb = () => { }) {
    console.log('Module', `'${module}'`, 'agora estÃ¡ sendo observado por mudanÃ§as by venom mods')
    fs.watchFile(require.resolve(module), async () => {
        await uncache(require.resolve(module))
        cb(module)
        })
    }

    function uncache(module = '.') {
    return new Promise((resolve, reject) => {
        try {
            delete require.cache[require.resolve(module)]
            resolve()
        } catch (e) {
            reject(e)
           }
       })
    }
    
start(global.config.session)
    .catch(console.log)

module.exports = {
    venom
}